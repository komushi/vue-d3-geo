webpackJsonp([0],[,,function(t,e,a){function r(t){a(15)}var n=a(0)(a(10),a(21),r,null,null);t.exports=n.exports},function(t,e,a){"use strict";e.a=function(t,e){var a,r,n=e.split(".");for(a=0,r=n.length;a<r;a++){if(!t.hasOwnProperty(n[a]))return;t=t[n[a]]}return t}},,,,function(t,e,a){function r(t){a(16)}var n=a(0)(a(11),a(22),r,null,null);t.exports=n.exports},,,function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a(4),n=(a.n(r),a(5)),l=(a.n(n),a(3)),i={id:{type:String,required:!0},topojsonPath:{type:String},width:{type:Number,default:1e3},height:{type:Number,default:1e3},colorRange:{type:String,default:"#e3f2fd,#2196f3,#0d47a1"},center:{type:String,default:"139.752268, 35.677043"},scale:{type:Number,default:11e4},layer1Objects:{type:String,default:"districts"},layer2Objects:{type:String,default:"blocks"},layer1FeatureName:{type:String,default:"properties.district"},layer1FeatureCode:{type:String,default:"properties.district_code"},layer2FeatureName:{type:String,default:"properties.block"},layer2FeatureCode:{type:String,default:"properties.block_code"},layer1EventData:{type:Object,default:null},layer2EventData:{type:String,default:"circleData"},layer1EventCountTag:{type:String,default:"dropoffCount"},layer1LegendTitle:{type:String,default:"３０分以内の降車イベント"}};e.default={name:"d3-geo-double-layer",data:function(){return{legendWidth:0}},props:i,mounted:function(){function t(){C.classed("active",!1),C=r.select(null),s.transition().duration(750).style("stroke-width","1.5px").attr("transform",""),p.selectAll("text").transition().style("display","block").transition().duration(250).style("fill-opacity",1),u.selectAll("path").transition().style("fill-opacity",0).style("display","none"),i.$emit("on-stop-events")}var e=this.layer1LegendTitle,i=(this.onReceiveEvents,this.onStopEvents,this),o=r.select(this.$el).append("svg").attr("width",i.width).attr("height",i.height);o.append("rect").attr("class","background").attr("width",i.width).attr("height",i.height).on("click",t);var s=o.append("g"),u=s.append("g").attr("id","layer2"),c=s.append("g").attr("id","layer1"),d=s.append("g").attr("id","layer2_label"),p=s.append("g").attr("id","layer1_label"),f=r.geo.mercator().center(this.center.split(",")).scale(this.scale).translate([i.width/2,i.height/2]),y=r.geo.path().projection(f),h=s.append("defs").attr("id","common_grads_def"),g=h.append("radialGradient").attr("gradientUnits","objectBoundingBox").attr("fx","50%").attr("fy","50%").attr("cx","50%").attr("cy","50%").attr("r","35%").attr("id","circleGrad1");g.append("stop").attr("offset","0%").style("stop-color","white").style("stop-opacity","1"),g.append("stop").attr("offset","100%").style("stop-color",function(t){return"orange"}).style("stop-opacity",".6");var v=this.getCountPoints(1,i.width,10),m=this.getCountScale(1,i.width);h.append("linearGradient").attr("id","legend-traffic").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").selectAll("stop").data(r.range(10)).enter().append("stop").attr("offset",function(t,e){return m(v[e])/i.width}).attr("stop-color",function(t,e){return i.colorRange.split(",")[0]});s.node().getBBox();this.legendWidth=Math.min(.8*i.width,600);var b=s.append("g").attr("id","legendWrapper").attr("transform","translate("+i.width/2+","+.95*i.height+")");b.append("rect").attr("id","legendRect").attr("x",-this.legendWidth/2).attr("y",0).attr("width",this.legendWidth).attr("height",10).style("fill","url(#legend-traffic)"),b.append("text").attr("class","layer1LegendTitle").attr("x",0).attr("y",-10).style("text-anchor","middle").text(e);var x=this.getXAxis(this.legendWidth,0);b.append("g").attr("id","axis").attr("transform","translate(0,10)").call(x),r.json(this.topojsonPath,function(t,e){var o=n.feature(e,e.objects[i.layer1Objects]).features,f=n.feature(e,e.objects[i.layer2Objects]).features,h=n.mesh(e,e.objects[i.layer1Objects],function(t,e){return t!==e}),g=i.colorRange.split(",")[0],v=s.append("defs").attr("id","layer1_hgrads").selectAll("radialGradient").data(o).enter().append("radialGradient").attr("gradientUnits","objectBoundingBox").attr("fx","50%").attr("fy","50%").attr("cx","50%").attr("cy","50%").attr("r","100%").attr("id",function(t,e){return"hgrad"+a.i(l.a)(t,i.layer1FeatureCode)});v.append("stop").attr("offset","0%").style("stop-color","white").style("stop-opacity","1"),v.append("stop").attr("offset","100%").style("stop-color",function(t,e){return g}).style("stop-opacity","1");var m=s.append("defs").attr("id","layer1_grads").selectAll("radialGradient").data(o).enter().append("radialGradient").attr("gradientUnits","objectBoundingBox").attr("fx","50%").attr("fy","50%").attr("cx","50%").attr("cy","50%").attr("r","35%").attr("id",function(t,e){return"grad"+a.i(l.a)(t,i.layer1FeatureCode)});m.append("stop").attr("offset","0%").style("stop-color",function(t,e){return g}).style("stop-opacity",".7"),m.append("stop").attr("offset","100%").style("stop-color",function(t,e){return g}).style("stop-opacity","1");var b=function(t){r.select(this).style("fill",function(t){return"url(#hgrad"+a.i(l.a)(t,i.layer1FeatureCode)+")"})},x=function(t){r.select(this).style("fill",function(t){return"url(#grad"+a.i(l.a)(t,i.layer1FeatureCode)+")"})};u.selectAll("path").data(f).enter().append("path").attr("d",y).attr("fill",function(t,e){return"url(#grad"+a.i(l.a)(t,i.layer1FeatureCode)+")"}).style("fill-opacity",0).style("display","none").attr("layer1-feature-code",function(t){return a.i(l.a)(t,i.layer1FeatureCode)}).attr("layer1-feature-name",function(t){return a.i(l.a)(t,i.layer1FeatureName)}).attr("layer2-feature-code",function(t){return a.i(l.a)(t,i.layer2FeatureCode)}).attr("layer2-feature-name",function(t){return a.i(l.a)(t,i.layer2FeatureName)}).attr("class","layer2").on("click",F).on("mouseover",S).on("mouseout",w),d.selectAll("text").data(f).enter().append("text").attr("class","label").style("fill-opacity",0).style("display","none").attr("transform",function(t){return"translate("+y.centroid(t)+")"}).attr("dy",".35em").attr("pointer-events","none").text(function(t){return a.i(l.a)(t,i.layer2FeatureName)}).attr("layer2-feature-code",function(t){return a.i(l.a)(t,i.layer2FeatureCode)}),c.selectAll("path").data(o).enter().append("path").attr("class","layer1").attr("d",y).style("fill",function(t,e){return"url(#grad"+a.i(l.a)(t,i.layer1FeatureCode)+")"}).attr("layer1-feature-code",function(t){return a.i(l.a)(t,i.layer1FeatureCode)}).attr("layer1-feature-name",function(t){return a.i(l.a)(t,i.layer1FeatureName)}).on("click",j).on("mouseover",b).on("mouseout",x),c.append("path").datum(h).attr("d",y).attr("class","layer1-boundary"),p.selectAll("text").data(o).enter().append("text").attr("class","label").attr("transform",function(t){return"translate("+y.centroid(t)+")"}).attr("dy",".35em").attr("pointer-events","none").text(function(t){return a.i(l.a)(t,i.layer1FeatureName)}).attr("layer1-feature-code",function(t){return a.i(l.a)(t,i.layer1FeatureCode)})});var C=r.select(null),F=function(e){if(C.node()&&this.getAttribute("layer1-feature-code")==C.node().getAttribute("layer1-feature-code"))return t()},j=function(e){if(C.node()===this)return t();C.classed("active",!1),C=r.select(this).classed("active",!0),A(e)},A=function(t){console.log("this is zoom");var e=y.bounds(t),r=e[1][0]-e[0][0],n=e[1][1]-e[0][1],o=(e[0][0]+e[1][0])/2,c=(e[0][1]+e[1][1])/2,d=.9/Math.max(r/i.width,n/i.height),f=[i.width/2-d*o,i.height/2-d*c];s.transition().duration(750).style("stroke-width",1.5/d+"px").attr("transform","translate("+f+")scale("+d+")"),p.selectAll("text").transition().style("fill-opacity",0).transition().style("display","none"),u.selectAll("path").transition().style("fill-opacity",1).style("display","block");a.i(l.a)(t,i.layer1FeatureCode);i.$emit("on-receive-events"),i.$emit("on-stop-events")},S=function(t){d.selectAll("text").filter(function(e){return a.i(l.a)(t,i.layer2FeatureCode)==a.i(l.a)(e,i.layer2FeatureCode)}).transition().style("fill-opacity",1).style("display","block"),r.select(this).style("fill",function(t){return"url(#hgrad"+a.i(l.a)(t,i.layer1FeatureCode)+")"})},w=function(t){d.selectAll("text").filter(function(e){return a.i(l.a)(t,i.layer2FeatureCode)==a.i(l.a)(e,i.layer2FeatureCode)}).transition().style("fill-opacity",0).transition().style("display","none"),r.select(this).style("fill",function(t){return"url(#grad"+a.i(l.a)(t,i.layer1FeatureCode)+")"})}},watch:{layer1EventData:function(t,e){this.visualizeLayer1Events(t)}},methods:{visualizeLayer1Events:function(t){var e=this,n=r.entries(t),i=r.max(n,function(t){return t.value[e.layer1EventCountTag]}),o=this.getColorScale(i,e.colorRange),s=this.getCountPoints(i,e.width,10);r.select("#common_grads_def").selectAll("linearGradient").selectAll("stop").attr("stop-color",function(t,e){return o(s[e])});var u=this.getXAxis(this.legendWidth,i);r.select("#axis").selectAll(".tick").remove(),r.select("#axis").call(u),r.select("#layer1").selectAll("path").filter(function(r){if("Feature"===r.type){var n=a.i(l.a)(r,e.layer1FeatureCode),i=t[n];if(!i)return r[e.layer1EventCountTag]=1,!0;var o=i[e.layer1EventCountTag];if(!r[e.layer1EventCountTag])return r[e.layer1EventCountTag]=o,!0;if(o!=r[e.layer1EventCountTag])return r[e.layer1EventCountTag]=o,!0}return!1}),r.select("#layer1_grads").selectAll("radialGradient").selectAll("stop").style("stop-color",function(t,a){return o(t[e.layer1EventCountTag])}),r.select("#layer1_hgrads").selectAll("radialGradient").selectAll("stop").filter(function(t){return"100%"===this.getAttribute("offset")}).style("stop-color",function(t,a){return o(t[e.layer1EventCountTag])}),r.select("#layer1").selectAll("path").filter(function(t){return"Feature"===t.type}).style("fill",function(t,r){return"url(#grad"+a.i(l.a)(t,e.layer1FeatureCode)+")"})},getCountScale:function(t,e){return r.scale.linear().domain([0,t]).range([0,e])},getCountPoints:function(t,e,a){var r=this.getCountScale(t,a),n=r.domain();n[2]=n[1]-n[0];for(var l=[],i=0;i<a;i++)l.push(i*n[2]/(a-1)+n[0]);return l},getColorScale:function(t,e){return r.scale.linear().domain([0,t/2,t]).range(e.split(","))},getXAxis:function(t,e){var a=r.scale.linear().range([-t/2,t/2]).domain([0,e]);return r.svg.axis().orient("bottom").ticks(5).scale(a)}}}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a(4),n=(a.n(r),a(5)),l=(a.n(n),a(3)),i={topojsonPath:{type:String},width:{type:Number,default:1e3},height:{type:Number,default:1e3},colorRange:{type:String,default:"#0d47a1,#e3f2fd"},center:{type:String,default:"139.752268, 35.677043"},scale:{type:Number,default:11e4},layerObjects:{type:String,default:"districts"},layerFeatureName:{type:String,default:"properties.district"},layerFeatureCode:{type:String,default:"properties.district_code"},featureNameStyle:{type:String,default:"static"}};e.default={name:"d3-geo-staic",props:i,mounted:function(){var t=this.layerObjects,e=this.colorRange,i=this.layerFeatureCode,o=this.layerFeatureName,s=this.featureNameStyle,u=r.select(this.$el).append("svg").attr("width",this.width).attr("height",this.height),c=u.append("g"),d=c.append("g").attr("id",this.layerObjects),p=c.append("g").attr("id",this.layerObjects+"_label");console.log("this.center:",this.center);var f=r.geo.mercator().center(this.center.split(",")).scale(this.scale).translate([this.width/2,this.height/2]),y=r.geo.path().projection(f);console.log("this.topojsonPath:",this.topojsonPath),r.json(this.topojsonPath,function(u,f){console.log("layerObjects:",t);var h=n.feature(f,f.objects[t]).features,g=n.mesh(f,f.objects[t],function(t,e){return t!==e}),v=r.scale.linear().domain([1,h.length]).interpolate(r.interpolateHcl).range(e.split(",")),m=c.append("defs").attr("id",t+"_hdef").selectAll("radialGradient").data(h).enter().append("radialGradient").attr("gradientUnits","objectBoundingBox").attr("fx","50%").attr("fy","50%").attr("cx","50%").attr("cy","50%").attr("r","100%").attr("id",function(t){return"hgrad"+a.i(l.a)(t,i)});m.append("stop").attr("offset","0%").style("stop-color","white").style("stop-opacity","1"),m.append("stop").attr("offset","100%").style("stop-color",function(t,e){return v(e+1)}).style("stop-opacity","1");var b=c.append("defs").attr("id",t+"_def").selectAll("radialGradient").data(h).enter().append("radialGradient").attr("gradientUnits","objectBoundingBox").attr("fx","50%").attr("fy","50%").attr("cx","50%").attr("cy","50%").attr("r","35%").attr("id",function(t){return"grad"+a.i(l.a)(t,i)});if(b.append("stop").attr("offset","0%").style("stop-color",function(t,e){return v(e+1)}).style("stop-opacity",".8"),b.append("stop").attr("offset","100%").style("stop-color",function(t,e){return v(e+1)}).style("stop-opacity","1"),"static"==s){var x=function(t){r.select(this).style("fill",function(t){return"url(#hgrad"+a.i(l.a)(t,i)+")"})},C=function(t){r.select(this).style("fill",function(t){return"url(#grad"+a.i(l.a)(t,i)+")"})};d.selectAll("path").data(h).enter().append("path").attr("d",y).attr("fill",function(t){return"url(#grad"+a.i(l.a)(t,i)+")"}).attr("layer-feature-code",function(t){return a.i(l.a)(t,i)}).attr("layer-feature-name",function(t){return a.i(l.a)(t,o)}).on("mouseover",x).on("mouseout",C),d.append("path").datum(g).attr("d",y).attr("class","layer1-boundary"),p.selectAll("text").data(h).enter().append("text").attr("class","label").attr("pointer-events","none").attr("transform",function(t){return"translate("+y.centroid(t)+")"}).attr("dy",".35em").text(function(t){return a.i(l.a)(t,o)}).attr("layer-feature-code",function(t){return a.i(l.a)(t,i)})}})}}},,function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a(7),n=a.n(r),l=a(2),i=a.n(l);a.d(e,"D3GeoDoubleLayer",function(){return i.a}),a.d(e,"D3GeoStatic",function(){return n.a})},,function(t,e){},function(t,e){},,,,,function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("div")},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("div")},staticRenderFns:[]}}],[13]);
//# sourceMappingURL=vue-d3-geo.594ad3e800b0085975b1.js.map